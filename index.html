<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I CAN LASER - Master v4.0 Official</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/fabric@5.3.0/dist/fabric.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Times+New+Roman&family=Cambria&family=Arial&family=Algerian&family=Oregano&family=Lucida+Calligraphy&family=Playball&family=Wished+Lovely&family=ALS+Script&display=Dancing+Script&family=swap" rel="stylesheet">
    
    <style>
    /* GENEL AYARLAR (BİLGİSAYAR VE YAZICI İÇİN) */
    body { font-family: 'Times New Roman', serif; background: #e0e0e0; display: flex; flex-direction: column; align-items: center; padding: 0; margin: 0; }
    .form-container { width: 790px; background: white; padding: 25px; border: 2px solid #000; box-sizing: border-box; margin-top: 20px; }
    .header { text-align: center; border-bottom: 3px solid #000; padding-bottom: 10px; margin-bottom: 15px; }
    .main-title { font-size: 50px; font-weight: 900; margin: 0; }
    .logo-img { width: 220px; }
    .row { display: flex; gap: 15px; margin-top: 10px; }
    .field { flex: 1; display: flex; align-items: baseline; border-bottom: 1px solid #000; }
    .field label { font-weight: bold; margin-right: 10px; font-size: 14px; white-space: nowrap; }
    .field input { border: none; width: 100%; outline: none; font-size: 16px; background: transparent; }
    .main-layout { display: flex; margin-top: 15px; border: 2px solid #000; }
    .left-panel { flex: 2; border-right: 2px solid #000; }
    .engraving-box { background: #f9f9f9; border-bottom: 2px solid #000; padding: 8px; text-align: center; }
    .engraving-box textarea { width: 95%; height: 50px; font-size: 20px; font-weight: bold; border: none; background: transparent; resize: none; text-align: center; }
    .canvas-wrap { position: relative; height: 420px; background: #fff; }
    .font-wrap { flex: 1; padding: 10px; background: #fff; height: 480px; overflow-y: auto; }
    .font-item { padding: 6px; cursor: pointer; color: #777; font-size: 13px; border-bottom: 1px solid #eee; }
    .font-item.selected { color: #000; font-weight: bold; background: #f0f0f0; border-left: 4px solid #d32f2f; }
    .notice { font-size: 10px; border-top: 2px solid #000; padding-top: 8px; margin-top: 15px; line-height: 1.3; }
    .sig-area { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 15px; }
    #sig-canvas { border-bottom: 1px solid #000; width: 180px; height: 60px; }
    .no-print { width: 100%; background: #333; padding: 10px; display: flex; justify-content: center; gap: 10px; position: sticky; top: 0; z-index: 1000; }
    button { padding: 10px 15px; font-weight: bold; cursor: pointer; border-radius: 5px; border: none; }
    .btn-save { background: #d32f2f; color: white; }

    /* TELEFON EKRANI AYARI (SADECE EKRANDA GÖRÜNÜR) */
    @media screen and (max-width: 800px) {
        body { background: #fff; }
        .form-container { width: 100% !important; border: none !important; padding: 10px !important; margin-top: 0; }
        .row { flex-direction: column; gap: 10px; } /* Kutuları alt alta diz */
        .main-layout { flex-direction: column; } /* Çizim alanı ve fontları alt alta diz */
        .left-panel { border-right: none; border-bottom: 2px solid #000; }
        .main-title { font-size: 30px; }
        .logo-img { width: 150px; }
        .canvas-wrap { height: 300px; }
        .font-wrap { height: 200px; }
        .sig-area { flex-direction: column; align-items: center; gap: 20px; }
    }

    /* YAZDIRMA AYARI (MAİL VE ÇIKTI ALIRKEN BURASI ÇALIŞIR) */
    @media print {
        .no-print { display: none !important; }
        body { background: white !important; padding: 0 !important; }
        .form-container { 
            width: 790px !important; 
            display: block !important; 
            border: 2px solid #000 !important;
            margin: 0 auto !important;
            transform: scale(1) !important; /* Yazdırırken küçültme yapma */
        }
        .row { display: flex !important; flex-direction: row !important; } /* Tekrar yan yana getir */
        .main-layout { display: flex !important; flex-direction: row !important; }
        .left-panel { border-right: 2px solid #000 !important; }
    }
    </style>
</head>
<body>

<div class="no-print">
    <strong>I CAN LASER - v4.0</strong>
    <button onclick="window.print()" style="background:white;">1. ONLY PRINT</button>
    <button class="btn-save" id="saveBtn" onclick="captureAndSend()">2. SAVE & MAIL FORM</button>
    <hr>
    <label>UPLOAD PHOTO:</label>
    <input type="file" id="imgInp" accept="image/*">
</div>

<div id="capture-area" class="form-container">
    <div class="header">
        <h1 class="main-title">I CAN LASER</h1>
        <img src="https://icanlaser.com/wp-content/uploads/2023/02/I-CAN-Laser-Logo-1.png" class="logo-img" crossorigin="anonymous">
    </div>

    <div class="row">
        <div class="field" style="flex:2"><label>Customer:</label><input type="text" id="cName"></div>
        <div class="field"><label>Date:</label><input type="text" id="oDate" readonly></div>
    </div>
    <div class="row">
        <div class="field"><label>Phone:</label><input type="text" id="cPhone" placeholder="(000) 000-0000"></div>
        <div class="field"><label>Email:</label><input type="email" id="cEmail"></div>
    </div>

    <div class="main-layout">
        <div class="left-panel">
            <div class="engraving-box"><textarea id="eText" oninput="updateCanvas()" placeholder="ENGRAVING TEXT"></textarea></div>
            <div class="canvas-wrap"><canvas id="c"></canvas></div>
        </div>
        <div class="font-wrap">
            <strong>SELECT FONT (10):</strong>
            <div id="fList">
                <div class="font-item" onclick="setFont('Times New Roman', this)">Times New Roman</div>
                <div class="font-item" onclick="setFont('Cambria', this)">Cambria</div>
                <div class="font-item selected" onclick="setFont('Arial', this)">Arial</div>
                <div class="font-item" onclick="setFont('Algerian', this)">Algerian</div>
                <div class="font-item" onclick="setFont('Oregano', this)">Oregano</div>
                <div class="font-item" onclick="setFont('Lucida Calligraphy', this)">Lucida Calligraphy</div>
                <div class="font-item" onclick="setFont('Playball', this)">Playball</div>
                <div class="font-item" onclick="setFont('Wished Lovely', this)">Wished Lovely</div>
                <div class="font-item" onclick="setFont('ALS Script', this)">ALS Script</div>
                <div class="font-item" onclick="setFont('Dancing Script', this)">Dancing Script</div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="field"><label>Price $:</label><input type="text" id="price"></div>
        <div class="field"><label>Pickup:</label><input type="date" id="pDate"></div>
    </div>

    <div class="notice">
        <strong>Terms:</strong> Items left over 90 days will be disposed of. I CAN LASER INC. is not liable for loss or damage. Laser engraving is permanent.
        <br><strong>* Prices in CAD. HST/GST will be added at checkout.</strong>
    </div>

    <div class="sig-area">
        <div class="field"><label>Customer Signature:</label><canvas id="sig-canvas"></canvas></div>
        <div style="text-align: right; flex: 1;">
            <p style="margin:0; font-weight: bold; font-size: 13px;">Served By:</p>
            <p style="margin:0; font-family: 'Playball', cursive; font-size: 20px; color: #d32f2f;">I CAN LASER INC.</p>
            <div class="field" style="margin-top:5px;"><label>Date:</label><input type="text" id="fDate" readonly></div>
        </div>
    </div>
</div>

<script>
    const canvas = new fabric.Canvas('c');
    const sigPad = new SignaturePad(document.getElementById('sig-canvas'));
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw_wucULHkCsVb9RK81OnIVWQtQzUcERbofcz8pUjTR5-HV-oUkQYLapEinl_oW-ABa/exec";
    let tObj, curFont = 'Arial';
    const bugun = new Date().toLocaleDateString('tr-TR');
    document.getElementById('oDate').value = bugun;
    document.getElementById('fDate').value = bugun;
    canvas.setWidth(520); canvas.setHeight(420);

    document.getElementById('imgInp').onchange = function(e) {
        const reader = new FileReader();
        reader.onload = function(f) {
            fabric.Image.fromURL(f.target.result, function(img) {
                const scale = Math.min(canvas.width/img.width, canvas.height/img.height);
                canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), { scaleX: scale, scaleY: scale, left: 260, top: 210, originX: 'center', originY: 'center' });
            });
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    function updateCanvas() {
        const val = document.getElementById('eText').value;
        if(!tObj) {
            tObj = new fabric.IText(val, { left: 260, top: 210, originX: 'center', originY: 'center', fontSize: 35, fontFamily: curFont });
            canvas.add(tObj);
        } else { tObj.set('text', val); canvas.renderAll(); }
    }

    function setFont(f, el) {
        curFont = f;
        document.querySelectorAll('.font-item').forEach(x => x.classList.remove('selected'));
        el.classList.add('selected');
        if(tObj) { tObj.set('fontFamily', f); canvas.renderAll(); }
    }

    async function captureAndSend() {
        const email = document.getElementById('cEmail').value;
        if(!email) { alert("Please enter Customer Email!"); return; }
        const btn = document.getElementById('saveBtn');
        btn.innerText = "SENDING..."; btn.disabled = true;

        try {
            const captureArea = document.getElementById('capture-area');
            const canvasImg = await html2canvas(captureArea, { useCORS: true, scale: 2 });
            const data = {
                customer: document.getElementById('cName').value,
                email: email,
                imageData: canvasImg.toDataURL("image/jpeg", 0.7)
            };
            await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
            alert("SUCCESS! The form has been sent to both you and the customer.");
            window.print();
        } catch (err) { alert("Check Connection or Google Settings!"); }
        btn.innerText = "2. SAVE & MAIL FORM"; btn.disabled = false;
    }
</script>
</body>

</html>



